!function(Y,b){"use strict";var d=ht.AlarmSeverity=function(z,r,q,j,b){this.value=z,this.name=r,this.nickName=q,this.color=j,this.displayName=b};ht.Default.def("ht.AlarmSeverity",b,{toString:function(){return this.displayName||this.name}}),function(){d.severities=new ht.List,d._vm={},d._nm={},d._cp=function(S,t){if(S&&t){var g=S.value-t.value;return g>0?1:0>g?-1:0}return S&&!t?1:!S&&t?-1:0},d.each=function(v,A){d.severities.each(v,A)},d.getSortFunction=function(){return d._cp},d.setSortFunction=function(z){d._cp=z,d.severities.sort(z)},d.add=function(J,K,S,r,i){var D=new d(J,K,S,r,i);return d._vm[J]=D,d._nm[K]=D,d.severities.add(D),d.severities.sort(d._cp),D},d.remove=function(G){var l=d._nm[G];return l&&(delete d._nm[G],delete d._vm[l.value],d.severities.remove(l)),l},d.CRITICAL=d.add(500,"Critical","C","#FF0000"),d.MAJOR=d.add(400,"Major","M","#FFA000"),d.MINOR=d.add(300,"Minor","m","#FFFF00"),d.WARNING=d.add(200,"Warning","W","#00FFFF"),d.INDETERMINATE=d.add(100,"Indeterminate","N","#C800FF"),d.CLEARED=d.add(0,"Cleared","R","#00FF00"),d.isClearedAlarmSeverity=function(K){return K?0===K.value:!1},d.getByName=function(T){return d._nm[T]},d.getByValue=function(V){return d._vm[V]},d.clear=function(){d.severities.clear(),d._vm={},d._nm={}},d.compare=function(s,v){return d._cp(s,v)}}();var E=ht.AlarmState=function(d){this._d=d,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",b,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var F=null;for(var h in this._am)h=d.getByName(h),d.isClearedAlarmSeverity(h)||0!==this.getAcknowledgedAlarmCount(h)&&(F=F?d.compare(F,h)>0?F:h:h);this._haa=F},_c2:function(){var T=null;for(var x in this._nm)x=d.getByName(x),d.isClearedAlarmSeverity(x)||0!==this.getNewAlarmCount(x)&&(T=T?d.compare(T,x)>0?T:x:x);this._hna=T},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var S in this._nm)if(S=d.getByName(S),!d.isClearedAlarmSeverity(S)&&0!==this.getNewAlarmCount(S)&&d.compare(this._hna,S)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var S=this._haa,r=this._hna,B=this._ps;this._hoa=S,d.compare(r,this._hoa)>0&&(this._hoa=r),d.compare(B,this._hoa)>0&&(this._hoa=B)},_c5:function(){var t=this._haa,T=this._hna;this._hta=t,d.compare(T,this._hta)>0&&(this._hta=T)},increaseAcknowledgedAlarm:function(Y,Q){if(0!==Q){Q=Q||1;var O=this._am[Y.name]||0;O+=Q,this._am[Y.name]=O,this._f()}},increaseNewAlarm:function(N,v){if(0!==v){v=v||1;var j=this._nm[N.name]||0;j+=v,this._nm[N.name]=j,this._f()}},decreaseAcknowledgedAlarm:function(j,m){if(0!==m){m||(m=1);var c=this._am[j.name]||0;if(c-=m,0>c)throw"Alarm count can not be negative";this._am[j.name]=c,this._f()}},decreaseNewAlarm:function(g,r){if(0!==r){r||(r=1);var L=this._nm[g.name]||0;if(L-=r,0>L)throw"Alarm count can not be negative";this._nm[g.name]=L,this._f()}},acknowledgeAlarm:function(u){this.decreaseNewAlarm(u,1),this.increaseAcknowledgedAlarm(u,1)},acknowledgeAllAlarms:function(S){if(S){var x=this.getNewAlarmCount(S);this.decreaseNewAlarm(S,x),this.increaseAcknowledgedAlarm(S,x)}else for(var b in this._nm)this.acknowledgeAllAlarms(d.getByName(b))},_c6:function(){this._aac=0;for(var L in this._am)L=d.getByName(L),this._aac+=this.getAcknowledgedAlarmCount(L)},getAcknowledgedAlarmCount:function(V){return V?this._am[V.name]||0:this._aac},getAlarmCount:function(e){return this.getAcknowledgedAlarmCount(e)+this.getNewAlarmCount(e)},_c7:function(){this._nac=0;for(var T in this._nm)this._nac+=this.getNewAlarmCount(d.getByName(T))},getNewAlarmCount:function(A){return A?this._nm[A.name]||0:this._nac},setNewAlarmCount:function(j,f){this._nm[j.name]=f,this._f()},removeAllNewAlarms:function(F){F?delete this._nm[F]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(T,Y){this._am[T.name]=Y,this._f()},removeAllAcknowledgedAlarms:function(O){O?delete this._am[O.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(e){if(this._ep||(e=null),this._ps!==e){var E=this._ps;this._ps=e,this._f(),this._d.fp("propagateSeverity",E,e)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(s){var r=this._ep;this._ep=s,this._d.fp("enablePropagation",r,s)&&(s||this.setPropagateSeverity(null))}});var B=ht.AlarmStatePropagator=function(E){this._dataModel=E,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",b,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(q){this._enable!==q&&(this._enable=q,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(Z){this.propagate(Z)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(E){E.data&&this.propagate(E.data)},handleDataPropertyChange:function(e){if("alarmState"===e.property||"enablePropagation"===e.property)this.propagate(e.data);else if("parent"===e.property){var T=e.oldValue;T&&this.propagate(T),this.propagate(e.data)}},propagate:function(z){z&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(z),this._isPropagating=!1)},propagateToTop:function(f){for(this.propagateToParent(null,f);f&&f.getParent();)this.propagateToParent(f,f.getParent()),f=f.getParent()},propagateToParent:function(Q,Y){var S=null;Y.getChildren().each(function(m){var U=m.getAlarmState().getHighestOverallAlarmSeverity();d.compare(U,S)>0&&(S=U)}),Y.getAlarmState().setPropagateSeverity(S)}}),ht.AlarmStateStatistics=function(M){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(M)},ht.Default.def("ht.AlarmStateStatistics",b,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(d){var A=this._dataModel;A!==d&&(A&&(A.umd(this.handleDataPropertyChange,this),A.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=d,this.reset(),d.md(this.handleDataPropertyChange,this),d.mm(this.handleDataModelChange,this),this.fp("dataModel",A,d))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(L){"alarmState"===L.property&&(this.increase(L.data),this.fireAlarmStateChange())},handleDataModelChange:function(U){"add"===U.kind?(this.increase(U.data),this.fireAlarmStateChange()):"remove"===U.kind?(this.decrease(U.data),this.fireAlarmStateChange()):"clear"===U.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,d.each(function(d){var M=this.getSumInfo(d);this.sumAcked+=M.ackedCount,this.sumNew+=M.newCount,this.sumTotal+=M.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(D){if(!D)return this.sumNew;var $=this.getSumInfo(D);return $.newCount},getAcknowledgedAlarmCount:function(n){if(!n)return this.sumAcked;var L=this.getSumInfo(n);return L.ackedCount},getTotalAlarmCount:function(C){if(!C)return this.sumTotal;var R=this.getSumInfo(C);return R.totalCount},getSumInfo:function(u){var S=this.severtiyMap[u.name];return S||(S={},S.newCount=0,S.ackedCount=0,S.totalCount=0,this.severtiyMap[u.name]=S),S},decrease:function(Q){var C=this.dataMap[Q.getId()];C&&(delete this.dataMap[Q.getId()],d.each(function(r){var A=C[r.name],d=this.getSumInfo(r);d.newCount=d.newCount-A.newCount,d.ackedCount=d.ackedCount-A.ackedCount,d.totalCount=d.totalCount-A.totalCount},this))},increase:function(v){if(this.decrease(v),!this._filterFunc||this._filterFunc(v)){var O={},G=v.getAlarmState();this.dataMap[v.getId()]=O,d.each(function(P){var N={};N.newCount=G.getNewAlarmCount(P),N.ackedCount=G.getAcknowledgedAlarmCount(P),N.totalCount=G.getAlarmCount(P),O[P.name]=N;var i=this.getSumInfo(P);i.newCount=i.newCount+N.newCount,i.ackedCount=i.ackedCount+N.ackedCount,i.totalCount=i.totalCount+N.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(_){var f=this._filterFunc;this._filterFunc=_,this.reset(),this.fp("filterFunc",f,_)},getFilterFunc:function(){return this._filterFunc}});var q=ht.Data.prototype;q.getAlarmState=function(){return this._alarmState||(this._alarmState=new E(this))},q=ht.DataModel.prototype,q.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},q.setEnableAlarmStatePropagator=function(r){r!=this.isEnableAlarmStatePropagator()&&(r?(this._alarmStatePropagator=new B(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},q=ht.graph.GraphView.prototype,q.getNote2=function(l){var f=l.getAlarmState().getHighestNewAlarmSeverity();if(f){var b=l.getAlarmState().getNewAlarmCount(f)+f.nickName;return l.getAlarmState().hasLessSevereNewAlarms()&&(b+="+"),b}return l.s("note2")},q.getNote2Background=function(A){var m=A.getAlarmState().getHighestNewAlarmSeverity();return m?m.color:A.s("note2.background")},q.getBodyColor=function(y){var s=y.getAlarmState().getHighestNativeAlarmSeverity();return s?s.color:y.s("body.color")},q.getBorderColor=function(P){var H=P.getAlarmState().getPropagateSeverity();return H?H.color:P.s("border.color")},q=ht.widget.TreeView.prototype,q.getBorderColor=function(b){var V=b.getAlarmState().getPropagateSeverity();return V?V.color:b.s("border.color")},q.getIcon=function(n){return n.getIcon()?"__alarmIcon__":null},q=ht.widget.TreeTableView.prototype,q.getBorderColor=function(K){var D=K.getAlarmState().getPropagateSeverity();return D?D.color:K.s("border.color")},q.getIcon=function(k){return k.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(H){return H.getIcon()}},color:{func:function(z){var f=z.getAlarmState().getHighestNativeAlarmSeverity();return f?f.color:z.s("body.color")}},rect:[0,0,16,16]}]});var m=ht.Style;m["note2.expanded"]=!0,m["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);