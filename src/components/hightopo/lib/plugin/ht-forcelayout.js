!function(U,I){"use strict";var L="ht",y=L+".layout.",q=U[L]||module.parent.exports.ht,x=q.List,G=q.DataModel,g=q.Node,A=q.Edge,V=q.Group,u=Math,D=u.sqrt,S=u.random,r=u.max,m=u.min,p=function(p){return p*p};q.Default.getInternal().addMSMap({ms_force:function(i){i._interval=50,i._stepCount=10,i._motionLimit=.01,i._edgeRepulsion=.65,i._nodeRepulsion=.65,i._damper=1,i._maxMotion=0,i._motionRatio=0,i.init=function(v){var d=this;v instanceof G?d.dm=v:d.gv=v,d._nodeMap={},d._nodes=new x,d._edges=new x},i.start=function(){var p=this,I=p.gv;if(!p._timer){var W=p.cdm=I?I.dm():p.dm;W.mm(p.handleDataModelChange,p),W.md(p.handleDataPropertyChange,p),I&&I.mp(p.handleGV,p),W.each(function(n){if(p.isVisible(n)&&p.isLayoutable(n)&&n instanceof g)if(p instanceof T){var Z=n.p3();n.p3([Z[0]+S(),Z[1]+S(),Z[2]+S()])}else Z=n.p(),n.p(Z.x+S(),Z.y+S())}),p._timer=setInterval(function(){p.relax()},p._interval),p._damper=1}},i.stop=function(){var c=this;c._timer&&(c.cdm.umm(c.handleDataModelChange,c),c.cdm.umd(c.handleDataPropertyChange,c),c.gv&&c.gv.ump(c.handleGV,c),clearInterval(c._timer),delete c._timer,delete c.cdm)},i.handleGV=function(C){var q=this;if("dataModel"===C.property){var R=C.oldValue,i=C.newValue;R&&(R.umm(q.handleDataModelChange,q),R.umd(q.handleDataPropertyChange,q)),this.cdm=i,i.mm(q.handleDataModelChange,q),i.md(q.handleDataPropertyChange,q)}},i.relax=function(){var V=this;if(!(V._damper<.1&&V._maxMotion<V._motionLimit)){this.cdm.each(function(Y){V.isVisible(Y)&&(Y instanceof A?V.addEdge(Y):Y instanceof g&&V.addNode(Y))});for(var $,E,t=0,c=V._edges,S=V._nodes,N=S.size();t<V._stepCount;t++){for(c.each(V.relaxEdge,V),$=0;N>$;$++)for(E=0;N>E;E++)V.relaxNode(S.get($),S.get(E));V.moveNode()}V._isAdjusting=1,S.each(function(r){r.fix||(r.p?r.v.p3(r.p):r.v.p(r.x,r.y))}),delete V._isAdjusting,V._nodeMap={},S.clear(),c.clear(),V.onRelaxed()}},i.onRelaxed=function(){},i.isRunning=function(){return!!this._timer},i.isVisible=function(i){return i.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(i):!0},i.isLayoutable=function(C){if(C.s("layoutable")===!1)return!1;if(C instanceof V)return!1;var W=this;return W.gv?W.gv.isMovable(C)&&!W.gv.isSelected(C):!(W.cdm||W.dm).sm().co(C)},i.getNodeRepulsion=function(){return this._nodeRepulsion},i.setNodeRepulsion=function(n){this._nodeRepulsion=n,this._damper=1},i.getEdgeRepulsion=function(){return this._edgeRepulsion},i.setEdgeRepulsion=function(V){this._edgeRepulsion=V,this._damper=1},i.getStepCount=function(){return this._stepCount},i.setStepCount=function(J){this._stepCount=J,this._damper=1},i.getInterval=function(){return this._interval},i.setInterval=function(L){var W=this;W._interval!==L&&(W._interval=L,W._timer&&(clearInterval(W._timer),W._timer=setInterval(function(){W.relax()},L)))},i.handleDataPropertyChange=function(j){!this._isAdjusting&&this.isVisible(j.data)&&(this._damper=1)},i.handleDataModelChange=function(){this._damper=1},i.damp=function(){var E=this._maxMotion,l=this._damper;this._motionRatio<=.001&&((.2>E||E>1&&.9>l)&&l>.01?this._damper-=.01:.4>E&&l>.003?this._damper-=.003:l>1e-4&&(this._damper-=1e-4)),E<this._motionLimit&&(this._damper=0)}}}),q.layout.ForceLayout=function(s){this.init(s)},q.Default.def(y+"ForceLayout",I,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(g){this._limitBounds=g,this._damper=1},getNodeSize:function(k){var L=this.gv;return L&&L.getDataUIBounds?L.getDataUIBounds(k):k.getRect()},addNode:function(I){var Y=this,q=Y._nodeMap[I._id];if(q)return q;var i=I.p();q={v:I,x:i.x,y:i.y,dx:0,dy:0,fix:!Y.isLayoutable(I),s:Y.getNodeSize(I)};var w=q.s,r=D(p(w.width)+p(w.height))*Y._nodeRepulsion;return q.r=1>r?100:r,Y._nodeMap[I._id]=q,Y._nodes.add(q),q},addEdge:function(B){if(B._40I&&B._41I){var N=this,u=N.addNode(B._40I),o=N.addNode(B._41I),J={s:u,t:o};o=o.s,u=u.s;var T=o.width+u.width,s=o.height+u.height;J.length=D(T*T+s*s)*N._edgeRepulsion,J.length<=0&&(J.length=100),N._edges.add(J)}},relaxEdge:function(X){var f=X.t,o=X.s,O=f.x-o.x,P=f.y-o.y,J=D(O*O+P*P),Y=100*X.length,M=.25*O/Y*J,L=.25*P/Y*J;f.dx=f.dx-M,f.dy=f.dy-L,o.dx=o.dx+M,o.dy=o.dy+L},relaxNode:function(q,p){if(q!==p){var u=0,x=0,A=q.x-p.x,c=q.y-p.y,t=A*A+c*c;0===t?(u=S(),x=S()):36e4>t&&(u=A/t,x=c/t);var N=q.r*p.r/400;u*=N,x*=N,q.dx+=u,q.dy+=x,p.dx-=u,p.dy-=x}},moveNode:function(){var i=this,V=i._limitBounds,q=i._maxMotion,W=0,p=i._damper;i._nodes.each(function(M){if(!M.fix){var X=M.dx*p,G=M.dy*p;if(M.dx=X/2,M.dy=G/2,W=r(D(X*X+G*G),W),M.x+=r(-40,m(40,X)),M.y+=r(-40,m(40,G)),V){M.x<V.x&&(M.x=V.x,i.adjust(1,0)),M.y<V.y&&(M.y=V.y,i.adjust(0,1));var J=M.s;M.x+J.width>V.x+V.width&&(M.x=V.x+V.width-J.width,i.adjust(-1,0)),M.y+J.height>V.y+V.height&&(M.y=V.y+V.height-J.height,i.adjust(0,-1))}}}),i._maxMotion=W,i._motionRatio=W>0?q/W-1:0,i.damp()},adjust:function(Y,K){var G=this._limitBounds;this._nodes.each(function(x){Y>0?(!G||x.x+x.s.width+Y<G.x+G.width)&&(x.x+=Y):(!G||x.x+Y>G.x)&&(x.x+=Y),K>0?(!G||x.y+x.s.height+K<G.y+G.height)&&(x.y+=K):(!G||x.y+K>G.y)&&(x.y+=K)})}});var T=q.layout.Force3dLayout=function(H){this.init(H)};q.Default.def(y+"Force3dLayout",I,{ms_force:1,getNodeSize3d:function(s){return s.s3()},addNode:function(T){var E=this,V=E._nodeMap[T._id];if(V)return V;V={v:T,p:T.p3(),d:[0,0,0],fix:!E.isLayoutable(T),s:E.getNodeSize3d(T)};var W=V.s,N=q.Default.getDistance(W)*E._nodeRepulsion;return V.r=1>N?100:N,E._nodeMap[T._id]=V,E._nodes.add(V),V},addEdge:function(U){if(U._40I&&U._41I){var Y=this,g=Y.addNode(U._40I),T=Y.addNode(U._41I),E={s:g,t:T};T=T.s,g=g.s,E.length=D(p(T[0]+g[0])+p(T[1]+g[1])+p(T[2]+g[2]))*Y._edgeRepulsion,E.length<=0&&(E.length=100),Y._edges.add(E)}},relaxEdge:function(R){var $=R.t.p,F=R.s.p,f=R.t.d,x=R.s.d,J=$[0]-F[0],L=$[1]-F[1],P=$[2]-F[2],G=D(J*J+L*L+P*P),z=100*R.length,S=.25*J/z*G,i=.25*L/z*G,W=.25*P/z*G;f[0]-=S,f[1]-=i,f[2]-=W,x[0]+=S,x[1]+=i,x[2]+=W},relaxNode:function(D,p){if(D!==p){var Y=D.p,V=p.p,r=0,n=0,l=0,T=Y[0]-V[0],v=Y[1]-V[1],o=Y[2]-V[2],M=T*T+v*v+o*o;0===M?(r=S(),n=S(),l=S()):216e6>M&&(r=T/M,n=v/M,l=o/M);var f=D.r*p.r/400,b=D.d,X=p.d;r*=f,n*=f,l*=f,b[0]+=r,b[1]+=n,b[2]+=l,X[0]-=r,X[1]-=n,X[2]-=l}},moveNode:function(){var u=this,U=u._maxMotion,N=0,J=u._damper;u._nodes.each(function(i){if(!i.fix){var n=i.p,h=i.d,A=h[0]*J,V=h[1]*J,Z=h[2]*J;h[0]=A/2,h[1]=V/2,h[2]=Z/2,N=r(D(A*A+V*V+Z*Z),N),n[0]+=r(-40,m(40,A)),n[1]+=r(-40,m(40,V)),n[2]+=r(-40,m(40,Z))}}),u._maxMotion=N,u._motionRatio=N>0?U/N-1:0,u.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);