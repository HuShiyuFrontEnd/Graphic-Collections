!function(b){"use strict";var v="ht",q=b[v],F=q.Default,A=Math,a=A.PI,w=2*a,m=A.sin,I=A.cos,x=A.atan2,_=A.sqrt,y=A.max,h=A.floor,d=(A.round,A.ceil),g=A.abs,r=q.Shape,P=q.Edge,M=q.List,T=q.Style,n=q.graph,H=F.getInternal(),L=H.ui(),G=null,U="__segmentLengths",s="__lineTotalLength",p="__linePoints",E="__distance0",W="flow.count",S="flow.step",J="flow.element.max",c="flow.element.count",e="flow.element.min",Y="flow.element.space",K="flow.element.autorotate",D="flow.element.background",u="flow.element.shadow.max",Z="flow.element.shadow.min",k="flow.element.shadow.begincolor",t="flow.element.shadow.endcolor",i="flow.element.shadow.visible",z="flow.element.image",j="flow",V="prototype",Q=n.GraphView[V],l=q.Data[V],$=L.DataUI[V],C=L.ShapeUI[V],B=L.EdgeUI[V],o=q.DataModel[V],R=C._80o,N=B._80o,X=o.prepareRemove,f=B._79o,O=C._79o,Bb=Q.setDataModel,pn=function(e){return document.createElement(e)};Q.calculatePointLength=function(t,S,O){var c=this,R=c.getDataUI(t);O==G&&(O=.1);var N=wb(R),H=[];if(N){for(var Y=N.length,m=0;Y>m;m++){var a=N[m];a._as&&(a=a._as);for(var k=a[0],Q=1;Q<a.length;Q++)H.push([k,a[Q]]),k=a[Q]}for(var y=[],m=0;m<H.length;m++){var u=To(H[m][0],H[m][1],S);y.push(u)}var W=y.slice(0);W.sort(function(P,X){return P.z>X.z?1:P.z<X.z?-1:0});var b=W[0];if(b.z<O){for(var x=y.indexOf(b),p=0,m=0;x>=m;m++)p+=x>m?F.getDistance(H[m][0],H[m][1]):F.getDistance(H[m][0],b);return p}}},F.calculatePointLength=function(C,k,L,N){N==G&&(N=.1);var z=wb(G,C,k),k=[];if(z){for(var n=z.length,S=0;n>S;S++){var V=z[S];V._as&&(V=V._as);for(var I=V[0],i=1;i<V.length;i++)k.push([I,V[i]]),I=V[i]}for(var d=[],S=0;S<k.length;S++){var f=To(k[S][0],k[S][1],L);d.push(f)}var R=d.slice(0);R.sort(function(e,k){return e.z>k.z?1:e.z<k.z?-1:0});var Y=R[0];if(Y.z<N){for(var x=d.indexOf(Y),M=0,S=0;x>=S;S++)M+=x>S?F.getDistance(k[S][0],k[S][1]):F.getDistance(k[S][0],Y);return M}}},Q.calculateClosestPoint=function(l,E){var z=this,q=z.getDataUI(l),s=wb(q),T=[];if(s){for(var I=s.length,k=0;I>k;k++){var X=s[k];X._as&&(X=X._as);for(var S=X[0],J=1;J<X.length;J++)T.push([S,X[J]]),S=X[J]}for(var M=[],k=0;k<T.length;k++){var D=To(T[k][0],T[k][1],E);M.push(D)}return M.sort(function(y,A){return y.z>A.z?1:y.z<A.z?-1:0}),M[0]}},F.calculateClosestPoint=function($,F,N){var R=wb(G,$,F),F=[];if(R){for(var k=R.length,L=0;k>L;L++){var l=R[L];l._as&&(l=l._as);for(var d=l[0],v=1;v<l.length;v++)F.push([d,l[v]]),d=l[v]}for(var t=[],L=0;L<F.length;L++){var n=To(F[L][0],F[L][1],N);t.push(n)}return t.sort(function(v,S){return v.z>S.z?1:v.z<S.z?-1:0}),t[0]}},Q.getPercentAngle=function(b,U){var v=this,F=v.getDataUI(b),E=b.getRotation?b.getRotation():0,S=wb(F);if(S)if(0===U){var T=S[0][0],L=S[0][1];E+=x(L.y-T.y,L.x-T.x)}else if(100===U){S=S[S.length-1];var T=S[S.length-2],L=S[S.length-1];E+=x(L.y-T.y,L.x-T.x)}else{for(var B=0,p=[],s=S.length,W=0;s>W;W++){var z=S[W],G=Lf(z);B+=G,p.push(G)}for(var $=B*U/100,r=ei($,p),Q=0,A=0;r>A;A++)Q+=p[A];$-=Q;for(var e=al(S[r],$),l=S[r],Y=0,o=0,I=0;I<l.length-1;I++){var V=l[I],H=l[I+1],K=H.x-V.x,M=H.y-V.y,d=_(K*K+M*M);if(Y+=d,Y>$){o=I;break}}var c=l[o];E+=x(e.y-c.y,e.x-c.x)}return E},F.getPercentAngle=function(R,U,p){var d=0,P=wb(G,R,U);if(P)if(0===p){var v=P[0][0],V=P[0][1];d+=x(V.y-v.y,V.x-v.x)}else if(100===p){P=P[P.length-1];var v=P[P.length-2],V=P[P.length-1];d+=x(V.y-v.y,V.x-v.x)}else{for(var g=0,j=[],F=P.length,e=0;F>e;e++){var O=P[e],n=Lf(O);g+=n,j.push(n)}for(var C=g*p/100,w=ei(C,j),S=0,E=0;w>E;E++)S+=j[E];C-=S;for(var $=al(P[w],C),z=P[w],s=0,c=0,u=0;u<z.length-1;u++){var X=z[u],N=z[u+1],Z=N.x-X.x,Y=N.y-X.y,h=_(Z*Z+Y*Y);if(s+=h,s>C){c=u;break}}var q=z[c];d+=x($.y-q.y,$.x-q.x)}return d},Q.calculateLength=function(E){var U=this,$=U.getDataUI(E),b=wb($),p=0;if(b)if(Array.isArray(b[0]))for(var f=b.length,Y=0;f>Y;Y++){var l=b[Y],L=Lf(l);p+=L}else p=Lf(b);return p},F.calculateLength=function(C,n){var C=wb(G,C,n),L=0;if(C)if(Array.isArray(C[0]))for(var v=C.length,k=0;v>k;k++){var Y=C[k],l=Lf(Y);L+=l}else L=Lf(C);return L};var To=F.calculateClosestPointOnLine=function(S,F,p){var l=S.x,C=S.y,q=F.x,D=F.y,G=p.x,f=p.y,e={},o=q-l,k=D-C,O=Math.sqrt(o*o+k*k),u=o/O,H=k/O,P=(-l+G)*u+(-C+f)*H;return e.x=l+P*u,e.y=C+P*H,_l(e,S,F)||(e.x=Math.abs(e.x-S.x)<Math.abs(e.x-F.x)?S.x:F.x,e.y=Math.abs(e.y-S.y)<Math.abs(e.y-F.y)?S.y:F.y),o=G-e.x,k=f-e.y,e.z=Math.sqrt(o*o+k*k),e},_l=function(b,d,r){return b.x>=Math.min(d.x,r.x)&&b.x<=Math.max(d.x,r.x)&&b.y>=Math.min(d.y,r.y)&&b.y<=Math.max(d.y,r.y)},Lf=function(f){for(var O=0,r=f.length-1,u=0;r>u;u++){var U=f[u],m=f[u+1],o=m.x-U.x,c=m.y-U.y,N=_(o*o+c*c);O+=N}return O},al=function(U,F){for(var Y=0,a=0,E=0,K=U.length-1,R=0;K>R;R++){var t=U[R],k=U[R+1],p=k.x-t.x,b=k.y-t.y;if(E=_(p*p+b*b),Y+=E,Y>F){Y-=E,a=R;break}}var s=U[a],T=U[a+1],d=x(T.y-s.y,T.x-s.x),D=F-Y,b=m(d)*D,p=I(d)*D;return{x:s.x+p,y:s.y+b}},Ko=function(Q,W,r,q){var A=I(q),w=m(q),l=A*W-w*r,T=w*W+A*r;return Q?{x:Q.x+l,y:Q.y+T}:{x:l,y:T}},gl=function(t,C){t[U]=t[s]=t[p]=C[E]=G},ib=function(N,$,i,E,Y,h){var j,D,l,s,z,u,n,r,X,S,V,y=[];if(g(E)>w&&(E=w),z=d(g(E)/(a/4)),j=E/z,D=-j,l=-i,z>0){u=N+I(i)*Y,n=$+m(-i)*h,y.push({x:u,y:n});for(var A=0;z>A;A++)l+=D,s=l-D/2,r=N+I(l)*Y,X=$+m(l)*h,S=N+I(s)*(Y/I(D/2)),V=$+m(s)*(h/I(D/2)),y.push({x:S,y:V}),y.push({x:r,y:X})}return y},wb=function(Q,V,C){if(V==G){var c=Q._data;if(c instanceof r){if(V=c.getPoints(),C=c.getSegments(),(!C||0===C.size())&&V){C=new q.List([1]);for(var K=1;K<V.size();K++)C.add(2)}}else if(c instanceof P){var T=Q._78o;if(T){var e=T.type,j=T.points,U=T.segments,s=T.edgeTypeInfo;if(!e||j){var X=T.sourcePoint,u=X.x,h=X.y,k=T.targetPoint,E=k.x,_=k.y;if(e)U?(V=new M({x:u,y:h}),V.addAll(j),V.add({x:E,y:_}),C=new M(U._as)):(V=new M({x:u,y:h}),C=new M([1]),j.each(function(l){V.add(l),C.add(2)}),V.add({x:E,y:_}),C.add(2));else if(T.looped){V=new M(ib(u,h,0,w,T.radius,T.radius)),C=new M([1]);for(var K=0;K<(V.size()-1)/2;K++)C.add(3)}else V=new M,T.center?(V.add({x:T.c1.x,y:T.c1.y}),V.add({x:u,y:h}),V.add({x:E,y:_}),V.add({x:T.c2.x,y:T.c2.y}),C=new M([1,2,2,2])):(V.add({x:u,y:h}),V.add({x:E,y:_}),C=new M([1,2]))}else if(s)if(V=new M(s.points._as),s.segments)C=new M(s.segments._as);else{C=new M([1]);for(var K=1;K<s.points.size();K++)C.add(2)}}}}if(V){if(Array.isArray(V)&&(V=new M(V)),"number"==typeof V.get(0)){for(var A=new q.List,K=0;K<V.size();K+=2)A.add({x:V.get(K),y:V.get(K+1)});V=A}if(!C){C=[];for(var K=0;K<V.size();K++)0===K?C.push(1):C.push(2)}Array.isArray(C)&&(C=new M(C));for(var v=H.toPointsArray(V._as,C._as,50),m=v.length,d=[],K=0;m>K;K++){var S=v[K];S.length>1&&d.push(S)}return d}},hh=function(j){var Q=j._data,K=wb(j);if(K){Q.s("flow.reverse")&&(K.reverse(),K.forEach(function(Q){Q.reverse()}));for(var b=0,L=[],$=K.length,w=0;$>w;w++){var n=K[w],R=Lf(n);b+=R,L.push(R)}if(Q[U]=L,Q[s]=b,Q[p]=K,Q instanceof P){var k=F.unionPoint(K),M=k.x+k.width/2,v=k.y+k.height/2;Q.$10e={x:M,y:v}}ac(j,!0)}},ac=(F.getPercentPositionOnPoints=function(x,r,q){if(x){var v=wb(G,x,r);if(v){var s;if(0===q)s=v[0][0];else if(100===q)v=v[v.length-1],s=v[v.length-1];else{for(var H=0,w=[],X=v.length,Q=0;X>Q;Q++){var S=v[Q],o=Lf(S);H+=o,w.push(o)}for(var f=H*q/100,Y=ei(f,w),F=0,$=0;Y>$;$++)F+=w[$];f-=F,s=al(v[Y],f)}return s}}},Q.getPercentPosition=function(p,f){var D=this,Q=D.getDataUI(p),e=wb(Q);if(e){var h;if(0===f)h=e[0][0];else if(100===f)e=e[e.length-1],h=e[e.length-1];else{for(var T=0,y=[],N=e.length,W=0;N>W;W++){var F=e[W],J=Lf(F);T+=J,y.push(J)}for(var $=T*f/100,w=ei($,y),P=0,B=0;w>B;B++)P+=y[B];$-=P,h=al(e[w],$)}return h}},function(m,G){var i=m._data,I=i[s],R=i.s(W),h=i.s(S),F=0,r=i[U],b=i.s(J),D=i.s(e),T=i.s(c),t=(b-D)/(T-1),n=[];if(r){if(1===T)n.push(b);else if(2===T)n.push(b),n.push(D);else{if(!(T>2))return;n.push(b);for(var X=T-2;X>0;X--)n.push(D+t*X);n.push(D)}var v=0,o=0;n.forEach(function(y){T-1>v&&(o+=i.getFlowElementSpace(y)),v++}),o+=(b+D)/2,F=(I-R*o+o)/R;var k=m[E];for(null==k&&(k=0),G||(k+=h);k>I+o;){var K=m._overCount;K?K++:K=1,K>=R&&(K=null),m._overCount=K,i.s("flow.autoreverse")?K?k-=F+o:(k=0,i.s("flow.reverse",!i.s("flow.reverse"))):k-=F+o}m[E]=k}}),$l=function(G){var Q=G.data,S=this.dm();if(Q&&"add"===G.kind){var C=S.$3e;C&&Q.s(j)&&C.indexOf(Q)<0&&C.push(Q)}"clear"===G.kind&&(S.$3e=[])},ih=function(B){var t=B.property,Q=B.data,m=B.newValue,e=this.dm().$3e;if(e&&"s:flow"===t)if(m)e.indexOf(Q)<0&&e.push(Q);else for(var h=e.length,G=0;h>G;G++)if(e[G]===Q){e.splice(G,1);break}},ei=ei=function(j,r){for(var o=0,m=r.length,R=0;m>R;R++){var N=r[R];if(o+=N,o>j)return R}return Math.min(R,m-1)},Pf=function(a){var $=this,P=$._data,D=P[s],H=P[U],l=P[p],n=P.s(W),Y=0,I=$[E],Q=P.s(J),i=P.s(e),f=P.s(c),o=P.s(Z),v=P.s(u),X=P.s(K),R=(v-o)/(f-1),A=(Q-i)/(f-1),g=P.getRotation?P.getRotation():0,M=P.getPosition?P.p():P.$10e,m=[],w=[];if(I!=G){if(1===f)m.push(Q);else if(2===f)m.push(Q),m.push(i);else{if(!(f>2))return;m.push(Q);for(var r=f-2;r>0;r--)m.push(i+A*r);m.push(i)}if(1===f)w.push(v);else if(2===f)w.push(v),w.push(o);else{if(!(f>2))return;w.push(v);for(var r=f-2;r>0;r--)w.push(o+R*r);w.push(o)}var q=0,S=0;m.forEach(function(u){f-1>q&&(S+=P.getFlowElementSpace(u)),q++}),S+=(Q+i)/2,Y=(D-n*S+S)/n,a.save();for(var r=0;n>r;r++){var k=I,N=0,F=$._overCount,z=0;P.s("flow.autoreverse")&&F&&F>n-(r+1)||(k-=r*(Y+S),q=0,m.forEach(function(A){var O=k-N;if(O>=0&&D>O){var r=!0,f=ei(O,H);z=0;for(var K=0;f>K;K++)z+=H[K];if(O-=z,r){var o=al(l[f],O),T=g;if(X){for(var v=l[f],U=0,e=0,Y=0;Y<v.length-1;Y++){var i=v[Y],d=v[Y+1],E=d.x-i.x,j=d.y-i.y,B=_(E*E+j*j);if(U+=B,U>O){e=Y;break}}var y=v[e];T+=x(o.y-y.y,o.x-y.x)}g&&(o=Ko(M,o.x-M.x,o.y-M.y,g)),$.$5e(a,o,A,w[q],T)}}N+=P.getFlowElementSpace(m[q]),q++}))}a.restore()}},us=function(){var m=this,w=m._data,X=w.s(J),b=!1,H=G;if(m._6I||(b=!0),H=w instanceof P?f.call(m):O.call(m),w.s(j)&&b){var s=w.s(u),E=w.s(i);E&&s>X&&(X=s),X>0&&F.grow(H,d(X/2)),hh(m)}return!w.s(j)&&b&&gl(w,m),H};l.getFlowElementSpace=function(){return this.s(Y)},C._79o=us,B._79o=us,T[J]==G&&(T[J]=7),T[e]==G&&(T[e]=0),T[W]==G&&(T[W]=1),T[S]==G&&(T[S]=3),T[c]==G&&(T[c]=10),T[Y]==G&&(T[Y]=3.5),T[K]==G&&(T[K]=!1),T[D]==G&&(T[D]="rgba(255, 255, 114, 0.4)"),T[k]==G&&(T[k]="rgba(255, 255, 0, 0.3)"),T[t]==G&&(T[t]="rgba(255, 255, 0, 0)"),T[i]==G&&(T[i]=1),T[u]==G&&(T[u]=22),T[Z]==G&&(T[Z]=4),o.prepareRemove=function(r){X.call(this,r);var M=r._dataModel,O=M.$3e;if(O)for(var h=O.length,N=0;h>N;N++)if(O[N]===r){O.splice(N,1);break}},Q.setDataModel=function(i){var N=this,U=N._dataModel;if(U!==i){U&&(U.umm($l,N),U.umd(ih,N),U.$3e=[]),i.mm($l,N),i.md(ih,N);var v=i.$3e=[];i.each(function(q){q.s(j)&&v.indexOf(q)<0&&v.push(q)}),Bb.call(N,i)}},Q.setFlowInterval=function(W){var p=this,f=p.$11e;p.$11e=W,p.fp("flowInterval",f,W),p.$7e!=G&&(clearInterval(p.$7e),delete p.$7e,p.enableFlow(W))},Q.getFlowInterval=function(){return this.$11e},Q.$9e=function(){var p,b,j,B=this,K=B.tx(),c=B.ty(),q=B.getZoom(),D=B.getWidth(),u=B.getHeight(),n={x:-K/q,y:-c/q,width:D/q,height:u/q},C=B.dm().$3e,r=B._56I,m=new M;if(C.forEach(function(J){r[J.getId()]&&(p=B.getDataUI(J),p&&(j=p._79o(),j&&m.add(j)))}),0!==m.size()&&(m.each(function(l){F.intersectsRect(n,l)&&(b=F.unionRect(b,l))}),b&&(b&&(F.grow(b,y(1,1/q)),b.x=h(b.x*q)/q,b.y=h(b.y*q)/q,b.width=d(b.width*q)/q,b.height=d(b.height*q)/q,b=F.intersection(n,b)),b))){var A=B._canvas.getContext("2d");A.save(),A.lineCap=F.lineCap,A.lineJoin=F.lineJoin,H.translateAndScale(A,K,c,q),A.beginPath(),A.rect(b.x,b.y,b.width,b.height),A.clip(),A.clearRect(b.x,b.y,b.width,b.height),B.$6e(A,b),A.restore()}},Q.$6e=function(E,m){var P,j,B=this;B._93db(E),B.each(function(f){B._56I[f._id]&&(P=B.getDataUI(f),P&&(j=P._79o(),(!m||F.intersectsRect(m,j))&&P._42(E)))}),B._92db(E)},Q.enableFlow=function(r){var U=this,$=U.dm(),Q=$.$3e;U.$7e==G&&(Q.forEach(function(y){var o=U.getDataUI(y);hh(o)}),U.$7e=setInterval(function(){$.$3e.forEach(function(m){ac(U.getDataUI(m))}),U.$9e()},r||U.$11e||50))},Q.disableFlow=function(){var i=this;clearInterval(i.$7e),delete i.$7e;var X=i.dm().$3e;X&&i.$9e()},$.$5e=function(j,W,n,r,g){var o=this,B=o._data,h=o.gv,q=B.s(D),P=B.s(k),l=B.s(t),p=B.s(i),Q=h.$8e,e=B.s(z);if(Q==G&&(Q=h.$8e={}),j.beginPath(),e!=G){var T=F.getImage(e),a=n/2;j.translate(W.x,W.y),j.rotate(g),j.translate(-W.x,-W.y),F.drawImage(j,T,W.x-a,W.y-a,n,n,B),j.translate(W.x,W.y),j.rotate(-g),j.translate(-W.x,-W.y)}else j.fillStyle=q,j.arc(W.x,W.y,n/2,0,w,!0),j.fill();if(p){var A=22,U=A+"_"+P+"_"+l,d=Q[U];if(d==G){var $=pn("canvas");H.setCanvas($,A,A);var Z=$.getContext("2d"),M=A/2,E=M,I=M;H.translateAndScale(Z,0,0,1),Z.beginPath();var N=Z.createRadialGradient(E,I,0,E,E,M);N.addColorStop(0,P),N.addColorStop(1,l),Z.fillStyle=N,Z.arc(E,I,M,0,w,!0),Z.fill(),d=Q[U]=$}var a=r/2;F.drawImage(j,d,W.x-a,W.y-a,r,r,B)}},B._80o=function(i){N.call(this,i);var n=this,Y=n._data,I=n.gv;Y.s(j)&&I.$7e!=G&&Pf.call(n,i)},C._80o=function($){R.call(this,$);var J=this,f=J._data,s=J.gv;f.s(j)&&s.$7e!=G&&Pf.call(J,$)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);